<!DOCTYPE html> 
<html> 
<head> 
	<title>Roulette</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<link rel="stylesheet" href="jquery.mobile-1.2.0.css" />
	<script src="jquery-1.8.1.min.js"></script>
	<script src="jquery.mobile-1.2.0.min.js"></script>
	
	<script>
	$(document).ready(function(){
		loadTables();
		
		$(document).bind( "pagebeforechange", function( e, data ) {
			if ( typeof data.toPage === "string" ) {
				var u = $.mobile.path.parseUrl(data.toPage);
				if ( u.hash.search(/^#table/) !== -1 ) {
					var id = u.hash.replace( /.*id=/, "" );
					showBuilding(id);
								
					//Prevent the default action
					e.preventDefault();
				}
			}
		});
		});
	
	function loadTables() {
		$('#tablesList').empty();
		$.getJSON('../api/tables/', function(data) {
			var tableObj = data;
			$.each(tableObj, function(key, tableObj) {
				var id = tableObj['id'];
				
				var code = "<li><a href=\"#table?id=" + id + "\">Table " + id + "</a></li>";
				$('#tablesList').append(code);
			});
			$("#tablesList").listview('refresh');
		});
	}
	
	function login() {
		var uName = $('#username').val();
        var Password = $('#password').val();

        var player = new Object();
        player['username'] = uName;
        player['password'] = Password;

        var jsonString = JSON.stringify(player);
        alert(jsonString);
        $.ajax({
            type: 'POST',
            url: '../api/login',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: jsonString,
            success: function (result) {
                alert("success");
                alert(result.username);
                alert(result.password);
                alert(result.accessToken);
                
            },
            error: function (result, ajaxOptions, thrownError) {
                alert("Errormessage: " + result.status);
                alert(thrownError);
            }
        });
		
		//window.location.href = "#overview";
		}
	
	function showBuilding(id) {
		$.getJSON('../api/table/' + id, function (data) {
// 			$('#idfield').val(data['@id']);
// 			$('#officialnamefield').val(data['officialname']);
// 			$('#nicknamefield').val(data['nickname']);
			
			var page = $('#table');
			$.mobile.changePage(page);
		});
	}
	</script>
</head> 
<body> 


<div data-role="page" id="login">
	<div data-role="header">
		<h1>Roulette Login</h1>
	</div>

	<div data-role="content">	
		<label for="idUsername">Username</label>
		<input type="text" id="username"/>
	
		<label for="isPassword">Password</label>
		<input type="text" id="password"/>
		
		<a data-role="button" data-icon="check" onClick="login();">Login</a>
	</div>
</div>

<div data-role="page" id="overview">
	<div data-role="header">
		<h1>Roulette Overview</h1>
	</div>

	<div data-role="content">	
		<ul id="tablesList" data-role="listview" data-inset="true" data-filter="true"></ul>	
	</div>
</div>

<div data-role="page" id="table">
	<div data-role="header">
		<h1>Roulette Tabel</h1>
	</div>

	<div data-role="content">	
		
	</div>
</div>

</div>
</body>
</html>